"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.validate = exports.fromNonce = void 0;
const crypto = require("crypto");
function digest(nonce) {
    console.log(crypto.createHmac("sha512", "digit").update(nonce).digest("hex"));
    return crypto.createHmac("sha512", process.env.ACTION_HUB_SECRET.toString()).update(nonce).digest("hex");
}
function fromNonce(nonce) {
    return `${nonce}/${digest(nonce)}`;
}
exports.fromNonce = fromNonce;
function validate(key) {
    const [nonce, providedDigest] = key.split("/");
    console.log("nonce " +nonce);
    console.log("providedDigest "+providedDigest);
    if (!nonce || !providedDigest) {
        return false;
    }
    console.log(Buffer.from(providedDigest));
    console.log(Buffer.from(digest(nonce)));
    return crypto.timingSafeEqual(Buffer.from(providedDigest), Buffer.from(digest(nonce)));
}
exports.validate = validate;
